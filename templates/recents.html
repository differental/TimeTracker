{%- let base_color -%}
{%- if is_emergency -%}
{%- let base_color = "red" -%}
{%- else -%}
{%- let base_color = "blue" -%}
{%- endif -%}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>TimeTracker — Recents</title>
    {% include "header.html" %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">
    {% include "navbar.html" %}
    <main class="flex-grow container mx-auto max-w-5xl px-4 py-8">
        <div class="mt-2 mb-4">
            <h1 class="text-3xl md:text-2xl font-semibold">Recents</h1>
            <p class="text-sm text-gray-600 mt-1">Showing a list of the most recent state changes.</p>
        </div>
        <div class="mb-6 bg-white shadow rounded-lg p-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div class="flex flex-col sm:flex-row gap-3 items-center">
                    <div class="flex items-center gap-2">
                        <label for="count-select" class="text-sm text-gray-600">Items</label>
                        <select id="count-select" class="px-3 py-2 border border-gray-200 rounded">
                            <option value="0">N/A</option>
                            <option value="10">10</option>
                            <option value="30">30</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="custom">Custom…</option>
                        </select>
                        <input id="count-custom-input" type="number" min="1" step="1" value="10" class="w-20 px-3 py-2 border border-gray-200 rounded hidden" />
                    </div>
                    <div class="flex items-center gap-2">
                        <label for="days-select" class="text-sm text-gray-600">Days</label>
                        <select id="days-select" class="px-3 py-2 border border-gray-200 rounded">
                            <option value="0">N/A</option>
                            <option value="1">1</option>
                            <option value="7">7</option>
                            <option value="30">30</option>
                            <option value="custom">Custom…</option>
                        </select>
                        <input id="days-custom-input" type="number" min="1" step="1" value="1" class="w-20 px-3 py-2 border border-gray-200 rounded hidden" />
                    </div>
                    <div class="flex items-center">
                        <button id="apply-filters" class="px-3 py-2 bg-white border border-gray-200 rounded shadow-sm text-sm">Apply</button>
                    </div>
                </div>
            </div>
            <div class="mt-4 overflow-x-auto">
                <table id="events-table" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">State</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Datetime</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Datetime</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                        </tr>
                    </thead>
                    <tbody id="events-tbody" class="bg-white divide-y divide-gray-100">
                        <!-- populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="mt-6 text-right">
            <a href="/?key={{ key }}" class="inline-block px-4 py-2 bg-{{ base_color }}-600 text-white rounded shadow hover:opacity-95">Back</a>
        </div>
    </main>
    {% include "footer.html" %}
    <script>
        window.ENTRY_KEY = "{{ key }}";
        window.BASE_COLOR = "{{ base_color }}";
        const STATES_DATA = [
            {% for s in states %}["{{ s.name }}", "{{ s.colour }}"], {% endfor %}
        ];

        document.addEventListener('DOMContentLoaded', () => wireFilters());
    </script>
    <script src="/static/js/recents.js" defer></script>
</body>
</html>
